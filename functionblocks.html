<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>BME280用拡張機能（日本語仕様）とブロック </title>
  
  <!-- LaTex風数式 -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

 <!-- CSSのリンク -->

 <link rel="stylesheet" href="style.css">
</head>

<body>
<section id="top">
<p>
<h1>BME280用拡張機能（日本語仕様）とブロック </h1>
<ol>
<li><a href="#usebme280">BME280を利用するために</a></li> 
<li><a href="#functionforjapanese">日本語仕様の拡張機能と利用方法</a></li>
<li><a href="#functionblocks"> 拡張機能のブロック紹介</a></li>
<ul style="list-style-type: none; padding-left: 0;">
<li>(1) <a href="#contblocks">センサー制御ブロック</a></li>
<li>(2) <a href="#basicblocks">環境データの基本ブロック</a></li>
<li>(3) <a href="#appblocks">応用ブロック</a></li>
<li>(4) <a href="#condblocks"> 条件ブロック</a></li>
</ul>
</ol>
</p>
</section>
<hr>

<section id="usebme280">
<p>
<h2>1. BME280を利用するために</h2>
<h3>＜BME280用拡張機能＞</h3>
<h4>【拡張機能とは】</h4>
micro:bit &trade; （以下micro:bitと表記）で環境センサーBME280を利用するためには、MakeCode &trade; （以下MakeCodeと表記）のBME280用拡張機能が必要です。<br>  
拡張機能はMakeCodeを利用してmicro:bitができることの幅を広げるための機能です。たとえばmicro:bitには無線通信機能があります。Bluetooth通信の利用も可能ですが、MakeCodeの基本ブロックではサポートされていません。MakeCodeの拡張機能からBluetooth通信の拡張機能を追加することでBluetooth通信が可能になります。拡張機能は、パソコンにプリンターを接続して印刷するためにインストールするドライバみたいなものだと思ってもかまいません。<br> 

<h4>【BME280用拡張機能】</h4> 
MakeCodeの拡張機能でBME280と検索すると拡張機能が数種類出てきます。シンプルにBME280と表記されたものはmicroPhythonのChineseコミュニティが制作したものです。基本的な機能はそろっているのでこれを利用するのが分かりやすいと思います。<br>
ただ、microPhython Chineseコミュニティの拡張機能はブロック表記が英語であること、取得される数値が整数値であることが弱点といえば弱点です。BME280は環境センサーとはいえ、気象データに特化したセンサーのため、ブロックには一般的に馴染みのない英語（Dew Point＝露点）もあります。<br>
<a href="#top">ページ先頭へ</a><br>
</p>
</section>
</dov>
<hr>

<section id="functionforjapanese">
<p>
<h2>2. 日本語仕様の拡張機能と利用方法</h2>
<h3>＜日本語仕様の概要＞</h3>
BME280拡張機能（日本語仕様）はmicroPhython Chineseコミュニティの拡張機能をベースに日本語移植および機能の変更と追加をを行いました。拡張機能そのものは、ほぼmicroPhython Chineseコミュニティのものと同じです。ただし、ブロック表記の日本語化に加え次の機能が加えられています。<br>
<h4>【microPhython Chineseコミュニティからの変更点】</h4>
<ul>　
<li>BME280から出力される気温・気圧・湿度の各数値の桁を整数/小数第１位/小数第２位から選べるようにした。</li>
<li>BME280が出す気温、気圧を用いて標高差を計算するブロックを加えた。（数値　整数/小数第１位の選択）</li>
<li>BME280が出す気温の値から飽和水蒸気圧と飽和水蒸気量を計算するブロックを加えた。（数値　整数/小数第１位の選択）　</li>
<li>露点計算の方法を改良マグヌス式に変更した。（数値　整数/小数第１位の選択）</li>
</ul>

<h3>＜利用方法＞</h3>
<B>micro:bitのMakeCodeのエディター画面から拡張機能をクリックし、次のURLを拡張機能の検索に張り付けて検索</B>してください。BME280の拡張機能（日本語仕様）が読み込まれ利用することができいます。<br>
<B>URL https://github.com/tanagogedora/bme280-jp</B> <BR>
<a href="#top">ページ先頭へ</a><br>
</p>
</section>
<hr>

<section>
<p>

<h2 id="functionblocks">3. 拡張機能のブロック紹介</h2>
<p>
<h3 id="contblocks">(1) センサー制御ブロック</h3>
<h4><BME280のセンサー機能を制御するための基本ブロック></hr>
<img src="image/sensorcontrol.jpeg"  style="float: right; margin: 10px; width: 200px;" alt="センサー制御ブロック" ><br>
<h4>【センサーの電源管理やI2Cアドレスを設定するブロック】</h4> 
<ul>
<li><B>I2Cアドレス　ブロック</B></li>  
I2C通信方式でBME280とmicro:bit間の通信（データ授受）を行う際に利用するBME280のアドレスを選択。0x76か0x77。アドレスはモジュールによって異なる。<br>
<li><B>センサー起動　ブロック</B></li>  
BME280の機能を利用開始するための命令を出すブロック。I2Cアドレスブロックとペアで使用。I2Cアドレスを設定し、センサー利用開始の流れになる。<br>  
<li><B>センサー停止　ブロック</B></li>  
BME280の機能を停止するための命令を出すブロック。<br> 
</ul>
<a href="#top">ページ先頭へ</a><br> 
</p>
<hr>
<p> 
<h3 id="basicblocks">(2) 環境データの基本ブロック</h3>
<h4>【センサーとしてのBME280が取得した数値を取り出すブロック】</h4>
<ul style="list-style-type: none; padding-left: 0;">
<li><B>BME280が取得した数値を取り出す</B>ブロック。</li>
<li><B>数値は整数.小数第1位・小数第２位</B></li>
</ul>
<ul>
<li><B>気温　ブロック</B></li>
<ul>
<li>気温データを出力</li>
<li>摂氏（セルシウス度　℃）と華氏（ファーレンハイト度　°F）に対応</li>
</ul>
<li><B>気圧　ブロック</B></li>
<ul>  
<li>気圧データを出力</li>
<li>パスカル（Pa）またはヘクトパスカル（ｈPa）に対応</li> 
</ul>
<li><B>湿度　ブロック</B></li>  
<ul> 
<li>湿度（相対湿度）を出力</li>  
<li>パーセント表示</li>  
</ul> 
</ul>
<a href="#top">ページ先頭へ</a><br>
</p>

<hr>

<p>
<h3 id="appblocks">(3) 応用ブロック</h3>
<h4>【BME280から得られたデータをもとに数値を計算・導くブロック】</h4>
<ul style="list-style-type: none; padding-left: 0;">
<li><B>BME280から得られたデータを基に各種数値を計算</B>するブロック</li>
<ul>
<li><B>標高差は基準点の気圧（初期気圧）以外、BME280から得たリアルタイムのデータ（現地の気圧・気温）を使用する</B></li>
<li><B>飽和水蒸気圧・飽和水蒸気量はBME280から得たリアルタイムのデータを利用するブロックと、ユーザーが気温を指定するブロックを用意</b></li>
<li><B>露点はBME280から得たリアルタイムのデータを利用するブロックと、ユーザーが気温・湿度を指定するブロックを用意</b></li>
</ul>
<li><B>数値は整数.小数第1位</B><BR></li>
</ul>
<ul>
<li><B>標高差　ブロック</B></li> 
<ul style="list-style-type: none; padding-left: 0;">
気圧と気温を用いて基準点からの標高差を計算。単位はメートル（ｍ）またはフィート（ft）<br>
<li>標高差の求め方</li>
<ul>
<li>基準点の気圧をP<sub>0</sub>（PaまたはhPa）、現場の気圧をP（PaまたはhPa）、気温をt（℃）とする</li>
<li>標高差Δh（ｍ）は次式で計算できる</li>
<ul style="list-style-type: none; padding-left: 0;">
<li><span style="font-size: 150%;">
\( Δh =\frac{\left( \left( \frac{P_0}{P} \right )^\frac{1}{5.257} -1 \right )\times \left(t+273.25  \right )}{0.0065} \)
</span></li>
注
<li> t+273.25　絶対温度の計算（単位：K ケルビン）</li>
<li> 0.0065（℃／m）　対流圏における気温減率（教科書等では0.65℃/100ｍと表記）</li>
</ul>
</ul>
</ul>
<li><B>飽和水蒸気圧　ブロック</B></li> 
<ul style="list-style-type: none; padding-left: 0;">
<li>気温から飽和水蒸気圧を計算</li>
<li>単位はヘクトパスカル（hPa）</li> 
<ul>
<li>気温をt（℃）とする。</li>
<li>Tetens(テテンス)の式により飽和水蒸気圧e(t)は次式で求まる</li>
<ul style="list-style-type: none; padding-left: 0;">
<span style="font-size: 150%;">
<li>
<B>\( e(t)=6.1078\times 10 ^ \left( \frac{7.5t}{t+237.3} \right ) \)</B>
</li>
</span>
<span style="font-size: 150%;">Tetens(テテンス)の式はe(t)=\(6.1078\times 10 ^ \left( \frac{at}{t+b} \right ) \)で表される。<br>
上式は気温０℃以上を想定し水面上での数値a=7.5、b=237.3を代入</span>したもの<br>
</ul>
</ul>
</ul>
<li><B>飽和水蒸気量　ブロック</B></li> 
<ul style="list-style-type: none; padding-left: 0;">
<li>気温から飽和水蒸気量を計算</li>
<li>単位はg/m<sup>3</sup>（hPa）</li>
 <ul>
<li>気温をt（℃）とする。</li>
<li>Tetens(テテンス)の式により求めた飽和水蒸気圧をPとする。</li>
<li>飽和水蒸気量a(t)は次式で求まる。
<ul style="list-style-type: none; padding-left: 0;">
<span style="font-size: 150%;">
<li>
<B>\( a(t)=217 \times \frac{P}{t+237.15} = 217 \times \frac{6.1078\times 10 ^ \left( \frac{7.5t}{t+237.3} \right )}{t+237.15} \) </B>
</li>
</span>
<span style="font-size: 150%;">上式は理想気体の状態方程式\( pV=nRT \)から求めた</span>式<br>
</ul>
</ul>
</ul>
<li><B>露点　ブロック</B></li>
<ul style="list-style-type: none; padding-left: 0;">
<li>気温（℃）と湿度から露点を計算</li>
<li>単位は℃</li>
<ul>
<li>気温をt（℃）とする。</li>
<li>湿度をRH（％）とする</li>
<li>飽和水蒸気量Td（℃）は次式（改良マグヌス式）で求まる。
<ul style="list-style-type: none; padding-left: 0;">
<span style="font-size: 150%;">
<li>
<B>\( Td= \frac{b \times \alpha}{a-\alpha} \) </B>
</li>
</span>
<span style="font-size: 150%;">ただし \( aとbは定数 \)で、  \( a=16.72 \)、\( b=243.12 \)。また　\( \alpha=\frac{aT}{b+T}+\ln \frac{RH}{100} \) から求める</span><br>
</ul>
</ul>
</ul>
</ul>
<a href="#top">ページ先頭へ</a><br> 
</p>

<hr>

<p> 
<h3 id="condblocks">(4) 条件ブロック</h3>
<h4>【ブロックの条件に合わせた処理を行うブロック】</h4>
<ul style="list-style-type: none; padding-left: 0;">
<li><B>気温・気圧・湿度について用意</B></li>
<li><B>値が「しきい値より大」または「しきい値より小」の時のイベントを指定</B></li>
</ul>
<a href="#top">ページ先頭へ</a><br>
</p>
</section>

<hr>

Indexに戻る
</body>
</html>
